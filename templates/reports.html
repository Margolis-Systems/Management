{% extends "layout.html" %}
{% block body %}
<style>
@media print {
  table {
    font-size: 10px;
  }
}
</style>
<table class="table table-striped" align="center" dir="rtl">
    <tr class="d-print-none">
        <td><button onclick="location.href='/reports?report=production'" type="button" class="btn btn-primary btn-block">דוח ייצור</button></td>
        <td><button onclick="location.href='/reports?report=orders'" type="button" class="btn btn-primary btn-block">דוח הזמנות</button></td>
        <td><button onclick="location.href='/reports?report=status'" type="button" class="btn btn-primary btn-block">דוח סטטוס הודפס</button></td>
        <td><button onclick="location.href='/reports?report=clear'" type="button" class="btn btn-danger btn-block">איפוס</button></td>
    </tr>
    <tr>
        <form method=POST id="date_form" autocomplete="off" action="{{ url_for('reports_page') }}">
            {% if machine_id %}
            <input type="hidden" name="machine_id" value="{{machine_id}}">
            {% endif %}
            <input type="hidden" name="report" value="{{report}}">
        <td>
            <label>מיום
            <input type="date" name="date_from" value="{{date.from}}" onchange="formSubmit('date_form');"></label>
        </td>
        <td>
            <label>עד יום
            <input type="date" name="date_to" value="{{date.to}}" onchange="formSubmit('date_form');"></label>
        </td>
        </form>
        <td colspan="2">
        {% if report_data %}<button onclick="window.print();" type="button" class="btn btn-success btn-block d-print-none">הדפס</button>
        {% endif %}
        </td>
    </tr>
</table>
{% if report_data %}
<table class="table" align="center" dir="rtl">
    <tr>
        {% if not data_to_display %}
        {% set data_to_display=report_data[0] %}
        {% endif %}
        {% for item in data_to_display %}
        {% if dictionary[item] %}
        {% set name = dictionary[item] %}
        {% else %}
        {% set name = item %}
        {% endif %}
        <td>
            <b>{{ name }}</b>
        </td>
        {% endfor %}
    </tr>
    {% for line in report_data %}
        {% if report == 'production' %}
            {% if line['order_id'] and not machine_id %}
            <tr ondblclick="location.href='/reports?report=production&machine_id={{line.machine_id}}'" class="d-print-none">
            {% else %}
            <tr ondblclick="location.href='/reports?report=production&machine_id={{line.machine_id}}'">
            {% endif %}
        {% else %}
        <tr>
        {% endif %}
        {% for item in data_to_display %}
        <td>
            {% if not line['order_id'] %}
            <b>
            {% if item == 'weight' %}
            סה"כ:
            {% endif %}
            {% endif %}
            {% if dictionary[line[item]] %}
                {{dictionary[line[item]]}}
            {% else %}
                {{ line[item] }}
            {% endif %}
            </b>
        </td>
        {% endfor %}
    </tr>
    {% endfor %}
</table>
{% endif %}
<script src="\static\js\shapes.js" ></script>
<script>
function formSubmit(formName){
    document.getElementById(formName).submit();
}
</script>
{% endblock %}