{% extends "layout.html" %}
{% block body %}
<table class="table table-striped" align="center" dir="rtl">
    <tr>
        <td><button class="btn btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="new_order_dropdown">
            הזמנה חדשה
          </button>
          <ul class="dropdown-menu" aria-labelledby="new_order_dropdown">
            <li><a class="dropdown-item" href="/new_order?regular">ברזל</a></li>
            <li><a class="dropdown-item" href="/new_order?rebar">רשת</a></li>
            <li><a class="dropdown-item" href="/new_order?rebar_special">כוורת</a></li>
            <li><a class="dropdown-item" href="/new_order?piles">כלונסאות</a></li>
            <li><a class="dropdown-item" href="/new_order?girders">מסבכונים</a></li>
          </ul></td>
        <td><button onclick='openNewWindow("\copy_order")' type="button" class="btn btn-primary btn-block" >העתק הזמנה</button></td>
        <td>
            <form method=POST id="date_form" autocomplete="off" action="{{ url_for('orders_page') }}">
                <label>הצג הזמנות מיום</label>
                <input type="date" name="date_from" value="{{defaults.from}}" onchange="formSubmit('date_form');">
                <label>עד יום</label>
                <input type="date" name="date_to" value="{{defaults.to}}" onchange="formSubmit('date_form');">
            </form>
        </td>
    </tr>
</table>
<table class="table table-striped" align="center" dir="rtl">
    <tr>
        <form method=POST autocomplete="off" action="{{ url_for('orders_page') }}">
        <td>
            <label>חיפוש</label>
            <input type="text" name="order_id" value="{{defaults.order_id}}" placeholder="מספר הזמנה">
            <input type="text" name="info.costumer_name" value="{{defaults['info.costumer_name']}}" placeholder="שם לקוח">
            {% if defaults['info.costumer_name'] %}
            <select name="info.costumer_site">
                {% for opt in defaults['info.costumer_site'] %}
                <option>{{opt}}</option>
                {% endfor %}
            </select>
            {% endif %}
            <button type="submit">חפש</button>
            <button type="button" onclick="location.href='/user_config?filter=';refresh();">איפוס</button>
        </td>
        </form>
        <td>סינון:</td>
        <td>
            <select onchange="location.href='/user_config?type='+this.value;refresh();" >
                <option style="display:none" selected>בחר סוג</option>
                {% for opt in order_types %}
                {% if opt in search['type'] %}
                <option value="{{opt}}" selected>{{dictionary[opt]}}</option>
                {% else %}
                <option value="{{opt}}">{{dictionary[opt]}}</option>
                {% endif %}
                {% endfor %}
            </select>
        </td>
        <td>
            <select onchange="location.href='/user_config?status='+this.value;refresh();" >
                <option style="display:none" selected>סטטוס</option>
                {% for opt in order_statuses %}
                {% if opt in search['type'] %}
                <option value="{{opt}}" selected>{{dictionary['order_status_'+opt]}}</option>
                {% else %}
                <option value="{{opt}}">{{dictionary['order_status_'+opt]}}</option>
                {% endif %}
                {% endfor %}
            </select>
        </td>
        <td colspan="5">
            <button onclick="location.href='/user_config?filter=';refresh();">איפוס</button>
        </td>
    </tr>
</table>
<table class="table table-condensed" dir="rtl" align="center">
    <tr>
        {% for item in display_items %}
        <td width="5%"  style="outline: thin solid;text-align: center">
            <b>{{dictionary[item]}}</b>
        </td>
        {% endfor %}
        <td width="5%"  style="outline: thin solid;text-align: center"></td>
        <td width="5%"  style="outline: thin solid;text-align: center"></td>
    </tr>
    {% for order in orders %}
    <tr bgcolor="{{dictionary.html_colors[order.status]}}">
        {% for item in display_items %}
        <td height="50" style="outline: thin solid;text-align: center"  ondblclick="location.href='/edit_order?{{ order['order_id'] }}'">
        {% if dictionary[order[item]] %}
            {{dictionary[order[item]]}}
        {% else %}
            {{ order[item] }}
        {% endif %}
            <!--  and order['rows']|int > order['finished'] -->
        {% if item == 'rows' and order['finished'] > 0 %}
        ( {{order['finished']}} )
        {% endif %}
        </td>
        {% endfor %}
        <td height="50" style="outline: thin solid;text-align: center">
            {% if order['in_use'] and order['in_use'] != 0 %}
            בשימוש על ידי: {{order['in_use']}}
            {% else %}
            <button type="button" onclick='openNewWindow("\change_order_status?order_id={{order["order_id"]}}")'>שנה סטטוס</button></td>
            {% endif %}
        <td height="50" style="outline: thin solid;text-align: center">
            <button type=button" onclick="openNewWindow('\order_files?order_id={{order.order_id}}')" type="button">צפיה בקבצים</button></td>
    </tr>
    {% endfor %}
</table >
<script src="\static\js\bootstrap.js" ></script>
<script src="\static\js\shapes.js" ></script>
<script src="\static\js\popper.js"></script>
<script>
const refresh = () => {
setTimeout(function(){
location.reload();
}, 300);
setTimeout("window.close()",300)
};
function formSubmit(formName){
    document.getElementById(formName).submit();
}
</script>
{% endblock %}